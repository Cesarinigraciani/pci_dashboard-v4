<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Modificar Obra</title>
  <link rel="stylesheet" href="styles/style-v2.css">
</head>

<body>

<header class="header-principal">
  <img src="assets/img/logo-empresa.png" alt="Logo">
  <div class="titulo-principal">
    <h1>MODIFICAR OBRA</h1>
    <h2>Aguero Instalaciones</h2>
  </div>
</header>

<div class="panel-admin">
  <div class="form-card">

    <h2 class="form-title">Editar Datos de la Obra</h2>

    <div class="form-grid">

      <div class="form-group">
        <label>Nombre de la obra</label>
        <input type="text" id="nombreObra">
      </div>

      <div class="form-group">
        <label>Nombre corto</label>
        <input type="text" id="nombreCorto">
      </div>

      <div class="form-group">
        <label>Direcci√≥n</label>
        <input type="text" id="direccionObra">
      </div>

      <div class="form-group">
        <label>Ciudad</label>
        <input type="text" id="ciudadObra">
      </div>

      <div class="form-group">
        <label>Fecha de inicio</label>
        <input type="date" id="fechaInicio">
      </div>

      <div class="form-group">
        <label>Encargado</label>
        <input type="text" id="encargadoObra">
      </div>

      <div class="form-group">
        <label>Horas estimadas</label>
        <input type="number" id="horasObra" min="0">
      </div>

    </div>

    <div class="form-buttons">
      <button onclick="window.location.href='lista_obras.html'" class="btn-secundario">‚¨ÖÔ∏è Volver</button>
      <button onclick="guardarCambios()" class="btn-primario">üíæ Guardar Cambios</button>
    </div>

  </div>
</div>



<script>
// ===============================
//  OBTENER ID DE LA OBRA DESDE LA URL
// ===============================
const params = new URLSearchParams(window.location.search);
const obraID = params.get("id");

// ===============================
//  CARGAR DATOS DE LA OBRA
// ===============================
document.addEventListener("DOMContentLoaded", () => {
  const obras = JSON.parse(localStorage.getItem("obrasPCI")) || [];
  const obra = obras.find(o => o.id === obraID);

  if (!obra) {
    alert("No se encontr√≥ la obra.");
    window.location.href = "lista_obras.html";
    return;
  }

  document.getElementById("nombreObra").value = obra.nombre || "";
  document.getElementById("nombreCorto").value = obra.nombreCorto || normalizar(obra.nombre);
  document.getElementById("direccionObra").value = obra.direccion || "";
  document.getElementById("ciudadObra").value = obra.ciudad || "";
  document.getElementById("fechaInicio").value = obra.fechaInicio || "";
  document.getElementById("encargadoObra").value = obra.encargado || "";
  document.getElementById("horasObra").value = obra.horasEstimadas || 0;
});

// ===============================
//  GUARDAR CAMBIOS
// ===============================
function guardarCambios() {
  const obras = JSON.parse(localStorage.getItem("obrasPCI")) || [];
  const index = obras.findIndex(o => o.id === obraID);

  if (index === -1) {
    alert("Error: no se encontr√≥ la obra.");
    return;
  }

  obras[index].nombre = document.getElementById("nombreObra").value.trim();
  obra.nombreCorto = document.getElementById("nombreCorto").value;
  obras[index].direccion = document.getElementById("direccionObra").value.trim();
  obras[index].ciudad = document.getElementById("ciudadObra").value.trim();
  obras[index].fechaInicio = document.getElementById("fechaInicio").value;
  obras[index].encargado = document.getElementById("encargadoObra").value.trim();
  obras[index].horasEstimadas = Number(document.getElementById("horasObra").value);

  localStorage.setItem("obrasPCI", JSON.stringify(obras));

  alert("Cambios guardados correctamente.");
  window.location.href = "lista_obras.html";
}
</script>

</body>
</html>
