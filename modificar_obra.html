<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Modificar Obra</title>
  <link rel="stylesheet" href="styles/style-v2.css">
</head>

<body>

<header class="header-principal">
  <img src="assets/img/logo-empresa.png" alt="Logo">
  <div class="titulo-principal">
    <h1>MODIFICAR OBRA</h1>
    <h2>Aguero Instalaciones</h2>
  </div>
</header>

<div class="panel-admin">
  <h2>Editar Datos de la Obra</h2>

  <label>Nombre de la obra:</label>
  <input type="text" id="nombreObra" class="input-text">

  <label>DirecciÃ³n:</label>
  <input type="text" id="direccionObra" class="input-text">

  <label>Ciudad:</label>
  <input type="text" id="ciudadObra" class="input-text">

  <label>Fecha de inicio:</label>
  <input type="date" id="fechaInicio" class="input-text">

  <label>Encargado:</label>
  <input type="text" id="encargadoObra" class="input-text">

  <label>Horas estimadas:</label>
  <input type="number" id="horasObra" class="input-text" min="0">

  <button onclick="guardarCambios()" class="btn-primario">ðŸ’¾ Guardar Cambios</button>
  <button onclick="window.location.href='lista_obras.html'" class="btn-secundario">ðŸ”™ Volver</button>
</div>

<script>
// ===============================
//  OBTENER ID DE LA OBRA DESDE LA URL
// ===============================
const params = new URLSearchParams(window.location.search);
const obraID = params.get("id");

// ===============================
//  CARGAR DATOS DE LA OBRA
// ===============================
document.addEventListener("DOMContentLoaded", () => {
  const obras = JSON.parse(localStorage.getItem("obrasPCI")) || [];
  const obra = obras.find(o => o.id === obraID);

  if (!obra) {
    alert("No se encontrÃ³ la obra.");
    window.location.href = "lista_obras.html";
    return;
  }

  document.getElementById("nombreObra").value = obra.nombre || "";
  document.getElementById("direccionObra").value = obra.direccion || "";
  document.getElementById("ciudadObra").value = obra.ciudad || "";
  document.getElementById("fechaInicio").value = obra.fechaInicio || "";
  document.getElementById("encargadoObra").value = obra.encargado || "";
  document.getElementById("horasObra").value = obra.horasEstimadas || 0;
});

// ===============================
//  GUARDAR CAMBIOS
// ===============================
function guardarCambios() {
  const obras = JSON.parse(localStorage.getItem("obrasPCI")) || [];
  const index = obras.findIndex(o => o.id === obraID);

  if (index === -1) {
    alert("Error: no se encontrÃ³ la obra.");
    return;
  }

  obras[index].nombre = document.getElementById("nombreObra").value.trim();
  obras[index].direccion = document.getElementById("direccionObra").value.trim();
  obras[index].ciudad = document.getElementById("ciudadObra").value.trim();
  obras[index].fechaInicio = document.getElementById("fechaInicio").value;
  obras[index].encargado = document.getElementById("encargadoObra").value.trim();
  obras[index].horasEstimadas = Number(document.getElementById("horasObra").value);

  localStorage.setItem("obrasPCI", JSON.stringify(obras));

  alert("Cambios guardados correctamente.");
  window.location.href = "lista_obras.html";
}
</script>

</body>
</html>
